module.exports=function(o){var r={};function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return o[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=o,n.c=r,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("react-dom")},function(e,t){e.exports=require("simplemde")},function(e,t){e.exports=require("simplemde/dist/simplemde.min.css")},function(e,t,o){},function(e,t,o){"use strict";o.r(t);var r=o(0),a=o.n(r),r=o(2),c=o.n(r),r=o(3),l=o.n(r),u=o(1);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(t){t=t.responseText||t.response;if(!t)return t;try{return JSON.parse(t)}catch(e){return t}}var i=function(){function o(e,t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.onPaste=function(e){var t=e.clipboardData;if(t&&"object"===p(t)){for(var o=t.items||t.files||[],r=[],n=0;n<o.length;n++){var i,s=o[n];s instanceof DataTransferItem?(i=s.getAsFile(),"string"!==s.kind&&i&&r.push(i)):r.push(s)}0<r.length&&e.preventDefault(),a.uploadFiles(r)}},this.onDrop=function(e,t){t.preventDefault();t=t.dataTransfer.files;a.uploadFiles(t)},this.codemirror=e,this.options=Object.assign(Object.assign({},o.defaultOptions),t),this.addEvents()}var e,t,r;return e=o,(t=[{key:"uploadFiles",value:function(o){for(var r=this,e=0;e<o.length;e++)(function(e){var t=o[e];if(r.isFileAllowed(t)){e=r.options.beforeUpload;if(!e)return r.insertProgressText(),r.upload(t);e=e(t);e instanceof Promise?e.then(function(){r.insertProgressText(),r.upload(t)}):!1!==e&&(r.insertProgressText(),r.upload(t))}})(e)}},{key:"upload",value:function(t){var e,o=this,r=new FormData,n=new XMLHttpRequest,i=this.options,s=i.action,a=i.name,c=i.headers,l=i.withCredentials,u=i.onError,p=this.options.data;for(e in(p="function"==typeof p?p(t):p)&&Object.keys(p).map(function(e){r.append(e,p[e])}),r.append(a,t),n.onerror=function(e){u&&u(e,null,t)},n.onload=function(){if(200===n.status||201===n.status)return o.onUploadSuccess(n,t);o.onUploadError(n,t)},n.open("post",s,!0),l&&"withCredentials"in n&&(n.withCredentials=!0),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),c)c.hasOwnProperty(e)&&n.setRequestHeader(e,c[e]);n.send(r)}},{key:"insertProgressText",value:function(){var e=this.options.progressText;this.lastValue=e,this.codemirror.replaceSelection(this.lastValue)}},{key:"isFileAllowed",value:function(e){var t=this.options.allowedTypes;return function t(e,o){return!!e&&(Array.isArray(e)?e.some(function(e){return t(e,o)}):e===o||new RegExp("^".concat(e.replace("*",".*"))).test(o))}(void 0===t?"*":t,e.type)}},{key:"onUploadSuccess",value:function(e,t){var o=this.codemirror,r=this.options,n=r.jsonName,i=r.progressText,s=r.onSuccess,a=this.lastValue,r=m(e),e=Object(u.get)(r,n),n="![file](".concat(e,")"),e=o.getCursor(),a=o.getValue().replace(a,n);o.setValue(a),e.ch+=n.length-i.length,o.setCursor(e),o.focus(),s&&s(r,t)}},{key:"onUploadError",value:function(e,t){var o=this.codemirror,r=this.options.onError,n=this.lastValue,i=o.getCursor(),n=o.getValue().replace(n,"");o.setValue(n),o.setCursor(i),o.focus(),r&&r((o=this.options,r=e,o="cannot post ".concat(o.action," ").concat(r.status),(o=new Error(o)).status=r.status,o),m(e),t)}},{key:"removeEvents",value:function(){this.codemirror.getWrapperElement().removeEventListener("paste",this.onPaste,!1),this.codemirror.off("drop",this.onDrop)}},{key:"addEvents",value:function(){this.codemirror.getWrapperElement().addEventListener("paste",this.onPaste,!1),this.codemirror.on("drop",this.onDrop)}},{key:"destroy",value:function(){this.removeEvents()}}])&&n(e.prototype,t),r&&n(e,r),o}();i.defaultOptions={action:"",name:"file",jsonName:"fileUrl",allowedTypes:"image/*",progressText:"![Uploading file...]()",data:{},headers:{},withCredentials:!1};o(4),o(5);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(o){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=y(o);return function(e,t){{if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined")}return function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e)}(this,r?(e=y(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}o=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(n,a.a.Component);var e,t,o,r=h(n);function n(e){var s;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(s=r.call(this,e)).state={contentChanged:!1},s.id="",s.wrapperId="",s.handleChange=function(e,t){s.simplemde&&s.triggerChange(s.simplemde.value())},s.handleEmojiSelect=function(e,t){s.simplemde&&s.props.emoji&&s.props.emojiToolkit&&(e="unicode"===s.props.emoji.insertConvertTo?s.props.emojiToolkit.shortnameToUnicode(e.shortname):e.shortname,s.simplemde.codemirror.replaceSelection(e))},s.hiddenEmojiPickerPopup=function(e){s.emojiPickerPopup&&"none"!==s.emojiPickerPopup.style.display&&(function(t,e){for(var o=Array.isArray(e)?e:[e];"BODY"!==t.tagName.toUpperCase();){if(o.some(function(e){return t==e}))return 1;t=t.parentNode}}(e.target,s.emojiPickerPopup)||"fa fa-smile-o"===e.target.className&&"emoji"===e.target.title||(s.emojiPickerPopup.style.display="none"))},s.triggerChange=function(e){var t=s.props.onChange;t&&(s.setState({contentChanged:!0}),t(e))},s.getMdeInstance=function(){var e=s.props.getMdeInstance;e&&s.simplemde&&e(s.simplemde)},s.addExtraKeys=function(){var e=s.props.extraKeys;e&&s.simplemde&&s.simplemde.codemirror.setOption("extraKeys",e)},s.removeEvents=function(){s.simplemde&&s.simplemde.codemirror.off("change",s.handleChange)},s.addEvents=function(){s.simplemde&&s.simplemde.codemirror.on("change",s.handleChange)},s.createEditor=function(){var e=s.props,t=e.value,o=e.options,r=void 0===o?{}:o,n=e.emoji,o=e.EmojiPicker,e=e.emojiToolkit;n&&n.enabled&&Array.isArray(r.toolbar)&&r.toolbar.includes("emoji")&&(o&&e?(r.toolbar=r.toolbar.map(function(e){return"emoji"===e?{name:"emoji",action:function(e){s.toggleEmojiPickerPopup(e.toolbarElements.emoji)},className:"fa fa-smile-o",title:"emoji"}:e}),s.emojiPickerPopup=document.createElement("div"),s.emojiPickerPopup.id="emoji-picker-popup",s.emojiPickerPopup.style.display="none",s.emojiPickerPopup.style.position="absolute",s.emojiPickerPopup.style.zIndex="99999",document.body.addEventListener("click",s.hiddenEmojiPickerPopup,!1),document.body.appendChild(s.emojiPickerPopup),i={emojiToolkit:n.emojiToolkit,categories:n.categories,onSelect:s.handleEmojiSelect,search:!0,recentCount:36,rowHeight:40},c.a.render(a.a.createElement(o,i),s.emojiPickerPopup)):console.error("使用emojiPicker必须提供EmojiPicker和emojiToolkit属性，基本用法详见：https://github.com/yanthink/react-simplemde-editor/blob/master/demo/src/pages/index.js"));var i=Object.assign(Object.assign({},r),{element:document.getElementById(s.id),initialValue:t}),i=new l.a(i),r=r.autosave;return r&&!0===r.enabled&&r.uniqueId&&((r=i.value())&&r!==t&&s.triggerChange(r)),i},s.id=s.props.id||"simplemde-editor-".concat(Date.now()),s.wrapperId="".concat(s.id,"-wrapper"),s}return e=n,(t=[{key:"componentDidMount",value:function(){var e,t;"undefined"!=typeof window&&(this.simplemde=this.createEditor(),this.addEvents(),this.addExtraKeys(),this.getMdeInstance(),e=(t=this.props).uploadOptions,t=t.emoji,e&&(this.upload=new i(this.simplemde.codemirror,e)),t&&t.enabled&&t.autoComplete&&this.initAutoCompleteEmoji())}},{key:"componentWillReceiveProps",value:function(e){var t;this.simplemde&&(t=this.state.contentChanged,e=e.value,t||void 0===e||e===this.simplemde.value()||this.simplemde.value(e),this.setState({contentChanged:!1}))}},{key:"componentWillUnmount",value:function(){this.upload&&this.upload.destroy(),this.textcomplete&&this.textcomplete.destroy(),this.simplemde&&(this.simplemde.isFullscreenActive()&&this.simplemde.toggleFullScreen(),this.simplemde.autosaveTimeoutId&&clearTimeout(this.simplemde.autosaveTimeoutId)),this.emojiPickerPopup&&(document.body.removeEventListener("click",this.hiddenEmojiPickerPopup,!1),document.body.removeChild(this.emojiPickerPopup)),this.removeEvents()}},{key:"toggleEmojiPickerPopup",value:function(e){var t;this.emojiPickerPopup&&("none"===this.emojiPickerPopup.style.display?(this.emojiPickerPopup.style.visibility="hidden",this.emojiPickerPopup.style.display="block",e=(t=function(e){for(var t=e.offsetLeft,o=e.offsetTop+e.scrollTop,r=e.offsetParent;null!==r;)t+=r.offsetLeft,o+=r.offsetTop,r=r.offsetParent;return{left:t,top:o}}(e)).top+44,(t=t.left-1)+this.emojiPickerPopup.scrollWidth>document.body.scrollWidth&&(t=document.body.scrollWidth-this.emojiPickerPopup.scrollWidth-20),this.emojiPickerPopup.style.top="".concat(e,"px"),this.emojiPickerPopup.style.left="".concat(t,"px"),this.emojiPickerPopup.style.visibility="visible"):this.emojiPickerPopup.style.display="none")}},{key:"initAutoCompleteEmoji",value:function(){var e=this.props,t=e.emoji,r=e.emojiToolkit,n=e.emojiData,o=e.Textcomplete,i=e.CodemirrorEditor,s=e.escape;this.simplemde&&t&&t.autoComplete&&(r&&n&&o&&i&&s?(this.textcomplete=new o(new i(this.simplemde.codemirror),{dropdown:{className:"emoji-dropdown-menu",maxCount:5}}),this.textcomplete.register([{match:/(\B):([\-+\w]*)$/,search:function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";(1<arguments.length?arguments[1]:void 0)(n.filter(function(e){var t=new RegExp("^(?:.* +)*".concat(s(o)),"i");return e.keywords.some(function(e){return t.test(e)})}))},replace:function(e){return"unicode"===t.insertConvertTo?r.shortnameToUnicode(e.shortname):e.shortname},template:function(e){var o={};Object(u.each)(t.emojiToolkit,function(e,t){o[t]=r[t],r[t]=e});e="".concat(r.toImage(e.shortname)," ").concat(e.shortname.replace(/:/g,""));return Object(u.each)(o,function(e,t){r[t]=e}),e}}])):console.error("开启emoji自动补全必须提供emojiToolkit、emojiData、Textcomplete、CodemirrorEditor和escape属性，基本用法详见：https://github.com/yanthink/react-simplemde-editor/blob/master/demo/src/pages/index.js"))}},{key:"render",value:function(){var e=this.props,t=e.className,e=e.label;return a.a.createElement("div",{id:this.wrapperId,className:t},e&&a.a.createElement("label",{htmlFor:this.id},e),a.a.createElement("textarea",{id:this.id}))}}])&&d(e.prototype,t),o&&d(e,o),n}(),t.default=o}]);