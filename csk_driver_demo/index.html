<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<title data-react-helmet="true">CSK硬件驱动使用示例 | 聆思文档中心</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="CSK硬件驱动使用示例 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="本篇介绍CSK的硬件驱动使用示例，包含UART、PWM、GPIO、I2C等通信接口。"><meta data-react-helmet="true" property="og:description" content="本篇介绍CSK的硬件驱动使用示例，包含UART、PWM、GPIO、I2C等通信接口。"><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/csk_driver_demo"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/csk_driver_demo"><link rel="stylesheet" href="/styles.16a99837.css">
<link rel="preload" href="/styles.e3c91203.js" as="script">
<link rel="preload" href="/runtime~main.6a294d59.js" as="script">
<link rel="preload" href="/main.3fe1632a.js" as="script">
<link rel="preload" href="/1.1e1f6025.js" as="script">
<link rel="preload" href="/2.3f3c4cf8.js" as="script">
<link rel="preload" href="/1a4e3797.628a2311.js" as="script">
<link rel="preload" href="/1be78505.bffdb615.js" as="script">
<link rel="preload" href="/122.18891566.js" as="script">
<link rel="preload" href="/121.debea348.js" as="script">
<link rel="preload" href="/935f2afb.42f90c1e.js" as="script">
<link rel="preload" href="/17896441.4662e802.js" as="script">
<link rel="preload" href="/ce2d7241.a9f9de00.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">聆思文档中心</strong></a><a class="navbar__item navbar__link" href="/CSK_online_guides_home">离在线开发指南</a><a class="navbar__item navbar__link" href="/csksdk_api">API</a><a class="navbar__item navbar__link" href="/download">下载中心</a><a class="navbar__item navbar__link" href="/lisa">Hello Lisa</a><a class="navbar__item navbar__link" href="/school">视频教程</a></div><div class="navbar__items navbar__items--right"><a href="https://cloud.listenai.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LSCloud</a><div class="navbar__search searchBarContainer_1-U_"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_18Th searchBarLoadingRing_zYFK"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">聆思文档中心</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/CSK_online_guides_home">离在线开发指南</a></li><li class="menu__list-item"><a class="menu__link" href="/csksdk_api">API</a></li><li class="menu__list-item"><a class="menu__link" href="/download">下载中心</a></li><li class="menu__list-item"><a class="menu__link" href="/lisa">Hello Lisa</a></li><li class="menu__list-item"><a class="menu__link" href="/school">视频教程</a></li><li class="menu__list-item"><a href="https://cloud.listenai.com" target="_blank" rel="noopener noreferrer" class="menu__link">LSCloud</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">CSK硬件驱动使用示例</h1></header><div class="markdown"><blockquote><p>本篇介绍CSK的硬件驱动使用示例，包含UART、PWM、GPIO、I2C等通信接口。
看完本篇你将了解到：</p><ul><li>uart串口通信实现指令的接收和发送。</li></ul></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-uart"></a>1. UART<a class="hash-link" href="#1-uart" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="11-基本介绍"></a>1.1 基本介绍<a class="hash-link" href="#11-基本介绍" title="Direct link to heading">#</a></h3><p>USART 驱动功能特性如下：</p><ul><li><p>支持 UART（Asynchronous）模式，不支持 Synchronous 模式。</p></li><li><p>使用硬件 FIFO。</p></li><li><p>非阻塞数据传输接口，硬件事件通过用户事件回调上报。</p></li><li><p>支持 DMA 传送（参数可配置）。</p></li><li><p>支持 Modem 控制模式，支持 RTS/CTS 流控。（可选）</p></li></ul><p>USART 驱动提供的静态接口实例为：Driver_USART0，Driver_USART1。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="12-使用场景"></a>1.2 使用场景<a class="hash-link" href="#12-使用场景" title="Direct link to heading">#</a></h3><p>目标机器需要使用通讯串口与上位机进行通讯。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="13-接口说明"></a>1.3 接口说明<a class="hash-link" href="#13-接口说明" title="Direct link to heading">#</a></h3><blockquote><p>串口初始化接口：用于初始化通讯串口，同时会初始化一个串口ringbuffer来存储接收的数据</p></blockquote><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// csk uart</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@brief</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> 串口的初始化，同时会初始化一个串口ringbuffer来存储接收的数据</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@return</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">csk_uart_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>串口接收接口：用于接收串口数据</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@brief</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> 从串口ringbuffer里面读取数据</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@param</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">  </span><span class="token doc-comment comment parameter" style="color:rgb(105, 112, 152);font-style:italic">dat</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">              接收数据的指针</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@param</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">  </span><span class="token doc-comment comment parameter" style="color:rgb(105, 112, 152);font-style:italic">len</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">              要接收的数据长度（单位：byte）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@param</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">  </span><span class="token doc-comment comment parameter" style="color:rgb(105, 112, 152);font-style:italic">ms</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">               超时时间（单位：ms）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@return</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">              实际收到的数据长度</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">int </span><span class="token function" style="color:rgb(130, 170, 255)">csk_uart_recv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int ms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> 串口发送接口：用于发送串口数据</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@brief</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> 通过串口发送数据</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@param</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">  </span><span class="token doc-comment comment parameter" style="color:rgb(105, 112, 152);font-style:italic">dat</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">              要发送的数据指针</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@param</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">  </span><span class="token doc-comment comment parameter" style="color:rgb(105, 112, 152);font-style:italic">len</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">              要发送的数据长度（单位：byte）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@param</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">  </span><span class="token doc-comment comment parameter" style="color:rgb(105, 112, 152);font-style:italic">ms</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">               超时时间（单位：ms）</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@return</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">              实际发送的数据长度</span></div><div class="token-line" style="color:#bfc7d5"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">int </span><span class="token function" style="color:rgb(130, 170, 255)">csk_uart_send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">dat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> int ms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="14-硬件配置"></a>1.4 硬件配置<a class="hash-link" href="#14-硬件配置" title="Direct link to heading">#</a></h3><p><strong>引脚配置</strong></p><p>在硬件配置资源<code>hardware.toml</code>中配置通讯串口（uart2）的Pin脚以及功能。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">txd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mux </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">peripheral</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">uart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">rxd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pin </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mux </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>软件配置</strong></p><p>在应用配置资源<code>application.toml</code>中配置通讯串口(uart2)的驱动接口配置。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">driver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">driver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">uart_ctrl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  uart </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  baudrate </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">115200</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="15-应用实现"></a>1.5 应用实现<a class="hash-link" href="#15-应用实现" title="Direct link to heading">#</a></h3><p><strong>实现通讯串口的初始化和数据接收</strong></p><p>代码清单：</p><ul><li>app_main.c</li></ul><p>构建一个通讯串口的数据接收任务初始化接口：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">uart_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">csk_uart_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">xTaskCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">uart_task_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;uart_task_proc&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1024</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">13</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> pdPASS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token constant" style="color:rgb(130, 170, 255)">CLOGW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[APP]Failed creating UART task&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>完成通讯串口数据接收任务的实现：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">uart_task_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter keyword" style="font-style:italic">void</span><span class="token parameter"> </span><span class="token parameter operator" style="color:rgb(137, 221, 255)">*</span><span class="token parameter">arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    uint8_t data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token constant" style="color:rgb(130, 170, 255)">MAX_CUSTOM_UART_BUF_CNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    uint16_t size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 从 UART 读取数据</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">memset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">read_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sizeof</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// size = read_data(&amp;data, sizeof(data), portMAX_DELAY);</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 将数据交给 ScriptEngine 处理</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">script_handle_uart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">vTaskDelete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>在用户的应用入口<em>app_main</em>中调用<strong>uart_init</strong>进行通讯串口的初始化：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">app_main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token constant" style="color:rgb(130, 170, 255)">CLOGD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[APP]Hello world&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">csk_handler_register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">CSK_EVENT_WAKE_UP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cb_wake_up</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">csk_handler_register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">CSK_EVENT_ESR_RECOGNITION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cb_esr_recognition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">csk_handler_register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">CSK_EVENT_ESR_TIMEOUT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cb_esr_timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">csk_handler_register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">CSK_EVENT_PLAYER_START</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cb_player_start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">csk_handler_register</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">CSK_EVENT_PLAYER_FINISH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cb_player_finish</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 如使用 UART，解除下面这一行的注释</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">uart_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>在识别回调接口中，将回调的数据通过ScriptEngine注册的mruby接口透传用户回调数据：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cb_esr_recognition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">keyword_attrs_t </span><span class="token parameter operator" style="color:rgb(137, 221, 255)">*</span><span class="token parameter">key_attrs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token constant" style="color:rgb(130, 170, 255)">CLOGD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[APP]ESR Recognition: kid=%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> key_attrs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">kid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// 如需在 ScriptEngine 中处理指令，解除下面这一行的注释</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">script_handle_intent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">key_attrs</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">txt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong>实现mruby业务</strong></p><p>代码清单：</p><ul><li>intents.rb <br></li></ul><p>在ruby代码中进行业务的部署，根据关键字的的意图进行业务实现：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">on_intent </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;打开空调&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;打开空调&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  num </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;count: #{num}&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> num </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token constant" style="color:rgb(130, 170, 255)">UART</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">transmit</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;PWR ON&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">on_intent </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;关闭空调&quot;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;关闭空调&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token constant" style="color:rgb(130, 170, 255)">UART</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">transmit</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;PWR OFF&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">default_intent </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">intent</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;default_intent: #{intent}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">on_uart_parsed </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">data</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token maybe-class-name">EngineCore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">info</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;UART: #{data}&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">end</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="16-测试"></a>1.6 测试<a class="hash-link" href="#16-测试" title="Direct link to heading">#</a></h3><p>通过&quot;<strong>小美小美</strong>&quot;进行语音唤醒，然后呼唤命令词&quot;<strong>打开空调</strong>&quot;。</p><p>从通讯串口的接收中可以看到，已经正确接收到了发送的数据&quot;<strong>PWR ON</strong>&quot;。</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">2021</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">01</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">27</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">09.379</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">PWR</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">ON</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2021</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">01</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">28</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">34.295</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2021</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">01</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">28</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">34.296</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2021</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">01</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">21</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">28</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">35.647</span><span class="token plain"> </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-uart" class="table-of-contents__link">1. UART</a><ul><li><a href="#11-基本介绍" class="table-of-contents__link">1.1 基本介绍</a></li><li><a href="#12-使用场景" class="table-of-contents__link">1.2 使用场景</a></li><li><a href="#13-接口说明" class="table-of-contents__link">1.3 接口说明</a></li><li><a href="#14-硬件配置" class="table-of-contents__link">1.4 硬件配置</a></li><li><a href="#15-应用实现" class="table-of-contents__link">1.5 应用实现</a></li><li><a href="#16-测试" class="table-of-contents__link">1.6 测试</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/styles.e3c91203.js"></script>
<script src="/runtime~main.6a294d59.js"></script>
<script src="/main.3fe1632a.js"></script>
<script src="/1.1e1f6025.js"></script>
<script src="/2.3f3c4cf8.js"></script>
<script src="/1a4e3797.628a2311.js"></script>
<script src="/1be78505.bffdb615.js"></script>
<script src="/122.18891566.js"></script>
<script src="/121.debea348.js"></script>
<script src="/935f2afb.42f90c1e.js"></script>
<script src="/17896441.4662e802.js"></script>
<script src="/ce2d7241.a9f9de00.js"></script>
</body>
</html>